stages:
  - check

# ---------- Python code checks ----------

python-lint:
  stage: check
  image: ghcr.io/astral-sh/uv:0.6-python3.13-bookworm-slim
  script:
    - uv run --only-group dev ruff check .
  rules:
    - changes:
        - "**/*.py"
        - pyproject.toml
        - uv.lock

python-format:
  stage: check
  image: ghcr.io/astral-sh/uv:0.6-python3.13-bookworm-slim
  script:
    - uv run --only-group dev ruff format --check .
  rules:
    - changes:
        - "**/*.py"
        - pyproject.toml
        - uv.lock

# ---------- Frontend checks ----------

.frontend-base:
  image: node:20-alpine
  before_script:
    - cd frontend
    - npm ci
  rules:
    - changes:
        - "frontend/**"

frontend-lint:
  stage: check
  extends: .frontend-base
  script:
    - npx eslint .

frontend-format:
  stage: check
  extends: .frontend-base
  script:
    - npx prettier --check "src/**/*.{ts,tsx,css,json}"

frontend-build:
  stage: check
  extends: .frontend-base
  script:
    - npm run build
