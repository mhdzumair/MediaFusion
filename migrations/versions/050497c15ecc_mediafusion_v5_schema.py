"""MediaFusion v5.0 Schema

This migration creates the complete database schema for MediaFusion v5.0.

Revision ID: 050497c15ecc
Revises: None
Create Date: 2026-01-04 08:15:35.078553

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
import sqlmodel

# revision identifiers, used by Alembic.
revision: str = "050497c15ecc"
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # Enable required PostgreSQL extensions
    op.execute('CREATE EXTENSION IF NOT EXISTS "pg_trgm"')

    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "audio_channel",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_audio_channel_name"), "audio_channel", ["name"], unique=True)
    op.create_table(
        "audio_format",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_audio_format_name"), "audio_format", ["name"], unique=True)
    op.create_table(
        "catalog",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("display_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_system", sa.Boolean(), nullable=False),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_catalog_name"), "catalog", ["name"], unique=True)
    op.create_table(
        "contribution_settings",
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("auto_approval_threshold", sa.Integer(), nullable=False),
        sa.Column("points_per_metadata_edit", sa.Integer(), nullable=False),
        sa.Column("points_per_stream_edit", sa.Integer(), nullable=False),
        sa.Column("points_for_rejection_penalty", sa.Integer(), nullable=False),
        sa.Column("contributor_threshold", sa.Integer(), nullable=False),
        sa.Column("trusted_threshold", sa.Integer(), nullable=False),
        sa.Column("expert_threshold", sa.Integer(), nullable=False),
        sa.Column("allow_auto_approval", sa.Boolean(), nullable=False),
        sa.Column("require_reason_for_edits", sa.Boolean(), nullable=False),
        sa.Column("max_pending_suggestions_per_user", sa.Integer(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "daily_stats",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stat_date", sa.Date(), nullable=False),
        sa.Column("new_users", sa.Integer(), nullable=False),
        sa.Column("active_users", sa.Integer(), nullable=False),
        sa.Column("new_streams", sa.Integer(), nullable=False),
        sa.Column("total_playbacks", sa.Integer(), nullable=False),
        sa.Column("top_media", sa.JSON(), nullable=True),
        sa.Column("top_streams", sa.JSON(), nullable=True),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_daily_stats_stat_date"), "daily_stats", ["stat_date"], unique=True)
    op.create_table(
        "genre",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_genre_name"), "genre", ["name"], unique=True)
    op.create_table(
        "hdr_format",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_hdr_format_name"), "hdr_format", ["name"], unique=True)
    op.create_table(
        "keyword",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_keyword_name"), "keyword", ["name"], unique=True)
    op.create_table(
        "language",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_language_name"), "language", ["name"], unique=True)
    op.create_table(
        "metadata_provider",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("display_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("api_base_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_external", sa.Boolean(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("priority", sa.Integer(), nullable=False),
        sa.Column("default_priority", sa.Integer(), nullable=False),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_metadata_provider_name"), "metadata_provider", ["name"], unique=True)
    op.create_table(
        "parental_certificate",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_parental_certificate_name"), "parental_certificate", ["name"], unique=True)
    op.create_table(
        "production_company",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("logo_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("origin_country", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("tmdb_id", sa.Integer(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("tmdb_id"),
    )
    op.create_index(op.f("ix_production_company_name"), "production_company", ["name"], unique=False)
    op.create_table(
        "rating_provider",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("display_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("icon_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("max_rating", sa.Float(), nullable=False),
        sa.Column("is_percentage", sa.Boolean(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_rating_provider_name"), "rating_provider", ["name"], unique=True)
    op.create_table(
        "tracker",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("status", sa.Enum("WORKING", "FAILING", "UNKNOWN", name="trackerstatus"), nullable=False),
        sa.Column("success_count", sa.Integer(), nullable=False),
        sa.Column("failure_count", sa.Integer(), nullable=False),
        sa.Column("success_rate", sa.Float(), nullable=False),
        sa.Column("last_checked", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_success", sa.DateTime(timezone=True), nullable=True),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_tracker_status"), "tracker", ["status"], unique=False)
    op.create_index(op.f("ix_tracker_url"), "tracker", ["url"], unique=True)
    op.create_table(
        "users",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uuid", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("username", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("password_hash", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("role", sa.Enum("USER", "PAID_USER", "MODERATOR", "ADMIN", name="userrole"), nullable=False),
        sa.Column("is_verified", sa.Boolean(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("last_login", sa.DateTime(timezone=True), nullable=True),
        sa.Column("contribution_points", sa.Integer(), nullable=False),
        sa.Column("metadata_edits_approved", sa.Integer(), nullable=False),
        sa.Column("stream_edits_approved", sa.Integer(), nullable=False),
        sa.Column("contribution_level", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_user_contribution_level", "users", ["contribution_level"], unique=False)
    op.create_index("idx_user_email", "users", ["email"], unique=False)
    op.create_index("idx_user_username", "users", ["username"], unique=False)
    op.create_index(op.f("ix_users_contribution_level"), "users", ["contribution_level"], unique=False)
    op.create_index(op.f("ix_users_contribution_points"), "users", ["contribution_points"], unique=False)
    op.create_index(op.f("ix_users_email"), "users", ["email"], unique=True)
    op.create_index(op.f("ix_users_is_active"), "users", ["is_active"], unique=False)
    op.create_index(op.f("ix_users_role"), "users", ["role"], unique=False)
    op.create_index(op.f("ix_users_updated_at"), "users", ["updated_at"], unique=False)
    op.create_index(op.f("ix_users_username"), "users", ["username"], unique=True)
    op.create_index(op.f("ix_users_uuid"), "users", ["uuid"], unique=True)
    op.create_table(
        "contributions",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("contribution_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("target_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("data", sa.JSON(), nullable=False),
        sa.Column("status", sa.Enum("PENDING", "APPROVED", "REJECTED", name="contributionstatus"), nullable=False),
        sa.Column("reviewed_by", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("review_notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_contribution_status", "contributions", ["status"], unique=False)
    op.create_index("idx_contribution_type", "contributions", ["contribution_type"], unique=False)
    op.create_index("idx_contribution_user", "contributions", ["user_id"], unique=False)
    op.create_index(op.f("ix_contributions_contribution_type"), "contributions", ["contribution_type"], unique=False)
    op.create_index(op.f("ix_contributions_status"), "contributions", ["status"], unique=False)
    op.create_index(op.f("ix_contributions_target_id"), "contributions", ["target_id"], unique=False)
    op.create_index(op.f("ix_contributions_updated_at"), "contributions", ["updated_at"], unique=False)
    op.create_index(op.f("ix_contributions_user_id"), "contributions", ["user_id"], unique=False)
    op.create_table(
        "iptv_source",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("source_type", sa.Enum("M3U", "XTREAM", "STALKER", name="iptvsourcetype"), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("m3u_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("server_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("encrypted_credentials", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_public", sa.Boolean(), nullable=False),
        sa.Column("import_live", sa.Boolean(), nullable=False),
        sa.Column("import_vod", sa.Boolean(), nullable=False),
        sa.Column("import_series", sa.Boolean(), nullable=False),
        sa.Column("live_category_ids", sa.JSON(), nullable=True),
        sa.Column("vod_category_ids", sa.JSON(), nullable=True),
        sa.Column("series_category_ids", sa.JSON(), nullable=True),
        sa.Column("last_synced_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_sync_stats", sa.JSON(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_iptv_source_active", "iptv_source", ["is_active"], unique=False)
    op.create_index("idx_iptv_source_type", "iptv_source", ["source_type"], unique=False)
    op.create_index("idx_iptv_source_user", "iptv_source", ["user_id"], unique=False)
    op.create_index(op.f("ix_iptv_source_updated_at"), "iptv_source", ["updated_at"], unique=False)
    op.create_table(
        "media",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("type", sa.Enum("MOVIE", "SERIES", "TV", "EVENTS", name="mediatype"), nullable=False),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("original_title", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("year", sa.Integer(), nullable=True),
        sa.Column("release_date", sa.Date(), nullable=True),
        sa.Column("end_date", sa.Date(), nullable=True),
        sa.Column("status", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("runtime_minutes", sa.Integer(), nullable=True),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("tagline", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("adult", sa.Boolean(), nullable=False),
        sa.Column("original_language", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("popularity", sa.Float(), nullable=True),
        sa.Column("website", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("primary_provider_id", sa.Integer(), nullable=True),
        sa.Column("created_by_user_id", sa.Integer(), nullable=True),
        sa.Column("is_user_created", sa.Boolean(), nullable=False),
        sa.Column("is_public", sa.Boolean(), nullable=False),
        sa.Column("user_original_title", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("last_refreshed_by_user_id", sa.Integer(), nullable=True),
        sa.Column("last_refreshed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("migrated_from_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("migrated_by_user_id", sa.Integer(), nullable=True),
        sa.Column("migrated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "nudity_status",
            sa.Enum("NONE", "MILD", "MODERATE", "SEVERE", "UNKNOWN", "DISABLE", name="nuditystatus"),
            nullable=False,
        ),
        sa.Column("is_blocked", sa.Boolean(), nullable=False),
        sa.Column("blocked_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("blocked_by_user_id", sa.Integer(), nullable=True),
        sa.Column("block_reason", sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
        sa.Column("last_scraped_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("last_scraped_by_user_id", sa.Integer(), nullable=True),
        sa.Column("total_streams", sa.Integer(), nullable=False),
        sa.Column("last_stream_added", sa.DateTime(timezone=True), nullable=False),
        sa.Column(
            "title_tsv",
            postgresql.TSVECTOR(),
            sa.Computed(
                "to_tsvector('simple'::regconfig, title)",
            ),
            nullable=False,
        ),
        sa.ForeignKeyConstraint(
            ["blocked_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["created_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["last_refreshed_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["last_scraped_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["migrated_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["primary_provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_media_blocked", "media", ["is_blocked"], unique=False, postgresql_where="is_blocked = true")
    op.create_index("idx_media_created_by_user", "media", ["created_by_user_id"], unique=False)
    op.create_index("idx_media_last_stream_added", "media", ["last_stream_added"], unique=False)
    op.create_index("idx_media_last_stream_added_type", "media", ["last_stream_added", "type"], unique=False)
    op.create_index("idx_media_title_fts", "media", ["title_tsv"], unique=False, postgresql_using="gin")
    op.create_index(
        "idx_media_title_trgm",
        "media",
        ["title"],
        unique=False,
        postgresql_using="gin",
        postgresql_ops={"title": "gin_trgm_ops"},
    )
    op.create_index("idx_media_type_title", "media", ["type", "title"], unique=False)
    op.create_index("idx_media_user_created", "media", ["is_user_created"], unique=False)
    op.create_index(op.f("ix_media_is_blocked"), "media", ["is_blocked"], unique=False)
    op.create_index(op.f("ix_media_is_user_created"), "media", ["is_user_created"], unique=False)
    op.create_index(op.f("ix_media_last_stream_added"), "media", ["last_stream_added"], unique=False)
    op.create_index(op.f("ix_media_nudity_status"), "media", ["nudity_status"], unique=False)
    op.create_index(op.f("ix_media_total_streams"), "media", ["total_streams"], unique=False)
    op.create_index(op.f("ix_media_type"), "media", ["type"], unique=False)
    op.create_index(op.f("ix_media_updated_at"), "media", ["updated_at"], unique=False)
    op.create_index(op.f("ix_media_year"), "media", ["year"], unique=False)
    op.create_table(
        "person",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("tmdb_id", sa.Integer(), nullable=True),
        sa.Column("imdb_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("profile_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("known_for_department", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("birthday", sa.Date(), nullable=True),
        sa.Column("deathday", sa.Date(), nullable=True),
        sa.Column("biography", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("place_of_birth", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("popularity", sa.Float(), nullable=True),
        sa.Column("provider_id", sa.Integer(), nullable=True),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_person_imdb", "person", ["imdb_id"], unique=False)
    op.create_index("idx_person_name", "person", ["name"], unique=False)
    op.create_index(
        "idx_person_name_trgm",
        "person",
        ["name"],
        unique=False,
        postgresql_using="gin",
        postgresql_ops={"name": "gin_trgm_ops"},
    )
    op.create_index("idx_person_tmdb", "person", ["tmdb_id"], unique=False)
    op.create_index(op.f("ix_person_imdb_id"), "person", ["imdb_id"], unique=True)
    op.create_index(op.f("ix_person_name"), "person", ["name"], unique=False)
    op.create_index(op.f("ix_person_tmdb_id"), "person", ["tmdb_id"], unique=True)
    op.create_index(op.f("ix_person_updated_at"), "person", ["updated_at"], unique=False)
    op.create_table(
        "rss_feed",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uuid", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("is_public", sa.Boolean(), nullable=False),
        sa.Column("source", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("torrent_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("auto_detect_catalog", sa.Boolean(), nullable=False),
        sa.Column("parsing_patterns", sa.JSON(), nullable=True),
        sa.Column("filters", sa.JSON(), nullable=True),
        sa.Column("metrics", sa.JSON(), nullable=True),
        sa.Column("last_scraped_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "url", name="uq_rss_feed_user_url"),
    )
    op.create_index("idx_rss_feed_active", "rss_feed", ["is_active"], unique=False)
    op.create_index("idx_rss_feed_public", "rss_feed", ["is_public"], unique=False)
    op.create_index("idx_rss_feed_source", "rss_feed", ["source"], unique=False)
    op.create_index("idx_rss_feed_user", "rss_feed", ["user_id"], unique=False)
    op.create_index(op.f("ix_rss_feed_is_active"), "rss_feed", ["is_active"], unique=False)
    op.create_index(op.f("ix_rss_feed_is_public"), "rss_feed", ["is_public"], unique=False)
    op.create_index(op.f("ix_rss_feed_name"), "rss_feed", ["name"], unique=False)
    op.create_index(op.f("ix_rss_feed_source"), "rss_feed", ["source"], unique=False)
    op.create_index(op.f("ix_rss_feed_updated_at"), "rss_feed", ["updated_at"], unique=False)
    op.create_index(op.f("ix_rss_feed_user_id"), "rss_feed", ["user_id"], unique=False)
    op.create_index(op.f("ix_rss_feed_uuid"), "rss_feed", ["uuid"], unique=True)
    op.create_table(
        "stream",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column(
            "stream_type",
            sa.Enum("TORRENT", "HTTP", "YOUTUBE", "USENET", "TELEGRAM", "EXTERNAL_LINK", name="streamtype"),
            nullable=False,
        ),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("source", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("uploader", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("uploader_user_id", sa.Integer(), nullable=True),
        sa.Column("release_group", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("is_blocked", sa.Boolean(), nullable=False),
        sa.Column("is_public", sa.Boolean(), nullable=False),
        sa.Column("playback_count", sa.Integer(), nullable=False),
        sa.Column("resolution", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("codec", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("quality", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("bit_depth", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_remastered", sa.Boolean(), nullable=False),
        sa.Column("is_upscaled", sa.Boolean(), nullable=False),
        sa.Column("is_proper", sa.Boolean(), nullable=False),
        sa.Column("is_repack", sa.Boolean(), nullable=False),
        sa.Column("is_extended", sa.Boolean(), nullable=False),
        sa.Column("is_complete", sa.Boolean(), nullable=False),
        sa.Column("is_dubbed", sa.Boolean(), nullable=False),
        sa.Column("is_subbed", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(
            ["uploader_user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_stream_active", "stream", ["is_active"], unique=False)
    op.create_index("idx_stream_active_blocked", "stream", ["is_active", "is_blocked"], unique=False)
    op.create_index("idx_stream_blocked", "stream", ["is_blocked"], unique=False)
    op.create_index("idx_stream_public", "stream", ["is_public"], unique=False)
    op.create_index("idx_stream_source", "stream", ["source"], unique=False)
    op.create_index("idx_stream_type", "stream", ["stream_type"], unique=False)
    op.create_index(
        "idx_stream_uploader_user",
        "stream",
        ["uploader_user_id"],
        unique=False,
        postgresql_where="uploader_user_id IS NOT NULL",
    )
    op.create_index(op.f("ix_stream_bit_depth"), "stream", ["bit_depth"], unique=False)
    op.create_index(op.f("ix_stream_codec"), "stream", ["codec"], unique=False)
    op.create_index(op.f("ix_stream_quality"), "stream", ["quality"], unique=False)
    op.create_index(op.f("ix_stream_release_group"), "stream", ["release_group"], unique=False)
    op.create_index(op.f("ix_stream_resolution"), "stream", ["resolution"], unique=False)
    op.create_index(op.f("ix_stream_updated_at"), "stream", ["updated_at"], unique=False)
    op.create_index(op.f("ix_stream_uploader"), "stream", ["uploader"], unique=False)
    op.create_table(
        "user_catalog",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("poster_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_public", sa.Boolean(), nullable=False),
        sa.Column("is_listed", sa.Boolean(), nullable=False),
        sa.Column("share_code", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("item_count", sa.Integer(), nullable=False),
        sa.Column("subscriber_count", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_user_catalog_listed", "user_catalog", ["is_listed"], unique=False)
    op.create_index("idx_user_catalog_owner", "user_catalog", ["user_id"], unique=False)
    op.create_index("idx_user_catalog_public", "user_catalog", ["is_public"], unique=False)
    op.create_index(op.f("ix_user_catalog_is_listed"), "user_catalog", ["is_listed"], unique=False)
    op.create_index(op.f("ix_user_catalog_is_public"), "user_catalog", ["is_public"], unique=False)
    op.create_index(op.f("ix_user_catalog_share_code"), "user_catalog", ["share_code"], unique=True)
    op.create_index(op.f("ix_user_catalog_updated_at"), "user_catalog", ["updated_at"], unique=False)
    op.create_index(op.f("ix_user_catalog_user_id"), "user_catalog", ["user_id"], unique=False)
    op.create_table(
        "user_profiles",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uuid", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("config", sa.JSON(), nullable=False),
        sa.Column("encrypted_secrets", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_default", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_profile_user_default", "user_profiles", ["user_id", "is_default"], unique=False)
    op.create_index(op.f("ix_user_profiles_updated_at"), "user_profiles", ["updated_at"], unique=False)
    op.create_index(op.f("ix_user_profiles_user_id"), "user_profiles", ["user_id"], unique=False)
    op.create_index(op.f("ix_user_profiles_uuid"), "user_profiles", ["uuid"], unique=True)
    op.create_table(
        "aka_title",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("language_code", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column(
            "title_tsv",
            postgresql.TSVECTOR(),
            sa.Computed(
                "to_tsvector('simple'::regconfig, title)",
            ),
            nullable=False,
        ),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id", "title"),
    )
    op.create_index("idx_aka_title_fts", "aka_title", ["title_tsv"], unique=False, postgresql_using="gin")
    op.create_index(
        "idx_aka_title_trgm",
        "aka_title",
        ["title"],
        unique=False,
        postgresql_using="gin",
        postgresql_ops={"title": "gin_trgm_ops"},
    )
    op.create_index(op.f("ix_aka_title_media_id"), "aka_title", ["media_id"], unique=False)
    op.create_index(op.f("ix_aka_title_title"), "aka_title", ["title"], unique=False)
    op.create_table(
        "download_history",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("profile_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=True),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("media_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("season", sa.Integer(), nullable=True),
        sa.Column("episode", sa.Integer(), nullable=True),
        sa.Column("stream_info", sa.JSON(), nullable=False),
        sa.Column("status", sa.Enum("COMPLETED", "FAILED", "CANCELLED", name="downloadstatus"), nullable=False),
        sa.Column("downloaded_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(["profile_id"], ["user_profiles.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_download_at", "download_history", ["downloaded_at"], unique=False)
    op.create_index("idx_download_profile", "download_history", ["profile_id"], unique=False)
    op.create_index("idx_download_user", "download_history", ["user_id"], unique=False)
    op.create_index(op.f("ix_download_history_media_id"), "download_history", ["media_id"], unique=False)
    op.create_index(op.f("ix_download_history_profile_id"), "download_history", ["profile_id"], unique=False)
    op.create_index(op.f("ix_download_history_user_id"), "download_history", ["user_id"], unique=False)
    op.create_table(
        "external_link_stream",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("service_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("service_icon_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("requires_subscription", sa.Boolean(), nullable=False),
        sa.Column("region", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("behavior_hints", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index(op.f("ix_external_link_stream_stream_id"), "external_link_stream", ["stream_id"], unique=True)
    op.create_table(
        "http_stream",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("format", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("size", sa.BigInteger(), nullable=True),
        sa.Column("bitrate_kbps", sa.Integer(), nullable=True),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("behavior_hints", postgresql.JSONB(astext_type=sa.Text()), nullable=True),
        sa.Column("drm_key_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("drm_key", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index(op.f("ix_http_stream_stream_id"), "http_stream", ["stream_id"], unique=True)
    op.create_table(
        "media_cast",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("person_id", sa.Integer(), nullable=False),
        sa.Column("character", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["person_id"], ["person.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_media_cast_media", "media_cast", ["media_id"], unique=False)
    op.create_index("idx_media_cast_order", "media_cast", ["media_id", "display_order"], unique=False)
    op.create_index("idx_media_cast_person", "media_cast", ["person_id"], unique=False)
    op.create_index(op.f("ix_media_cast_media_id"), "media_cast", ["media_id"], unique=False)
    op.create_index(op.f("ix_media_cast_person_id"), "media_cast", ["person_id"], unique=False)
    op.create_table(
        "media_catalog_link",
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("catalog_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["catalog_id"], ["catalog.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("media_id", "catalog_id"),
    )
    op.create_index(op.f("ix_media_catalog_link_catalog_id"), "media_catalog_link", ["catalog_id"], unique=False)
    op.create_table(
        "media_crew",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("person_id", sa.Integer(), nullable=False),
        sa.Column("department", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("job", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["person_id"], ["person.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_media_crew_department", "media_crew", ["department"], unique=False)
    op.create_index("idx_media_crew_media", "media_crew", ["media_id"], unique=False)
    op.create_index("idx_media_crew_person", "media_crew", ["person_id"], unique=False)
    op.create_index(op.f("ix_media_crew_media_id"), "media_crew", ["media_id"], unique=False)
    op.create_index(op.f("ix_media_crew_person_id"), "media_crew", ["person_id"], unique=False)
    op.create_table(
        "media_external_id",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("provider", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("external_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("provider", "external_id", name="uq_provider_external_id"),
    )
    op.create_index("idx_media_external_media", "media_external_id", ["media_id"], unique=False)
    op.create_index("idx_media_external_provider_id", "media_external_id", ["provider", "external_id"], unique=False)
    op.create_index(op.f("ix_media_external_id_media_id"), "media_external_id", ["media_id"], unique=False)
    op.create_index(op.f("ix_media_external_id_provider"), "media_external_id", ["provider"], unique=False)
    op.create_index(op.f("ix_media_external_id_updated_at"), "media_external_id", ["updated_at"], unique=False)
    op.create_table(
        "media_genre_link",
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("genre_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["genre_id"], ["genre.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("media_id", "genre_id"),
    )
    op.create_index(op.f("ix_media_genre_link_genre_id"), "media_genre_link", ["genre_id"], unique=False)
    op.create_table(
        "media_image",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("provider_id", sa.Integer(), nullable=False),
        sa.Column("image_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("language", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("aspect_ratio", sa.Float(), nullable=True),
        sa.Column("width", sa.Integer(), nullable=True),
        sa.Column("height", sa.Integer(), nullable=True),
        sa.Column("vote_average", sa.Float(), nullable=True),
        sa.Column("vote_count", sa.Integer(), nullable=True),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id", "provider_id", "image_type", "url", name="uq_media_image"),
    )
    op.create_index(op.f("ix_media_image_image_type"), "media_image", ["image_type"], unique=False)
    op.create_index(op.f("ix_media_image_is_primary"), "media_image", ["is_primary"], unique=False)
    op.create_index(op.f("ix_media_image_media_id"), "media_image", ["media_id"], unique=False)
    op.create_table(
        "media_keyword_link",
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("keyword_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["keyword_id"], ["keyword.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("media_id", "keyword_id"),
    )
    op.create_index(op.f("ix_media_keyword_link_keyword_id"), "media_keyword_link", ["keyword_id"], unique=False)
    op.create_table(
        "media_parental_certificate_link",
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("certificate_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["certificate_id"], ["parental_certificate.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("media_id", "certificate_id"),
    )
    op.create_index(
        op.f("ix_media_parental_certificate_link_certificate_id"),
        "media_parental_certificate_link",
        ["certificate_id"],
        unique=False,
    )
    op.create_table(
        "media_production_company_link",
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("company_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["company_id"], ["production_company.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("media_id", "company_id"),
    )
    op.create_index(
        op.f("ix_media_production_company_link_company_id"),
        "media_production_company_link",
        ["company_id"],
        unique=False,
    )
    op.create_table(
        "media_rating",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("rating_provider_id", sa.Integer(), nullable=False),
        sa.Column("rating", sa.Float(), nullable=False),
        sa.Column("rating_raw", sa.Float(), nullable=True),
        sa.Column("vote_count", sa.Integer(), nullable=True),
        sa.Column("rating_type", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("certification", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("fetched_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(
            ["rating_provider_id"],
            ["rating_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id", "rating_provider_id", "rating_type", name="uq_media_rating"),
    )
    op.create_index(op.f("ix_media_rating_media_id"), "media_rating", ["media_id"], unique=False)
    op.create_table(
        "media_review",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("provider_id", sa.Integer(), nullable=True),
        sa.Column("user_id", sa.Integer(), nullable=True),
        sa.Column("author", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("author_avatar", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("content", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("rating", sa.Float(), nullable=True),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("published_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["rating_provider.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_media_review_media", "media_review", ["media_id"], unique=False)
    op.create_index("idx_media_review_provider", "media_review", ["provider_id"], unique=False)
    op.create_index("idx_media_review_user", "media_review", ["user_id"], unique=False)
    op.create_index(op.f("ix_media_review_media_id"), "media_review", ["media_id"], unique=False)
    op.create_index(op.f("ix_media_review_updated_at"), "media_review", ["updated_at"], unique=False)
    op.create_table(
        "media_trailer",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("video_key", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("site", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("trailer_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("language", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("country", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_official", sa.Boolean(), nullable=False),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("size", sa.Integer(), nullable=True),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id", "video_key", "site"),
    )
    op.create_index("idx_media_trailer_media", "media_trailer", ["media_id"], unique=False)
    op.create_index("idx_media_trailer_type", "media_trailer", ["trailer_type"], unique=False)
    op.create_index(op.f("ix_media_trailer_media_id"), "media_trailer", ["media_id"], unique=False)
    op.create_index(op.f("ix_media_trailer_updated_at"), "media_trailer", ["updated_at"], unique=False)
    op.create_table(
        "mediafusion_rating",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("average_rating", sa.Float(), nullable=False),
        sa.Column("total_votes", sa.Integer(), nullable=False),
        sa.Column("upvotes", sa.Integer(), nullable=False),
        sa.Column("downvotes", sa.Integer(), nullable=False),
        sa.Column("five_star_count", sa.Integer(), nullable=False),
        sa.Column("four_star_count", sa.Integer(), nullable=False),
        sa.Column("three_star_count", sa.Integer(), nullable=False),
        sa.Column("two_star_count", sa.Integer(), nullable=False),
        sa.Column("one_star_count", sa.Integer(), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(op.f("ix_mediafusion_rating_media_id"), "mediafusion_rating", ["media_id"], unique=True)
    op.create_table(
        "metadata_suggestions",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("field_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("current_value", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("suggested_value", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("reason", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("status", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("reviewed_by", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("review_notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_suggestion_field", "metadata_suggestions", ["field_name"], unique=False)
    op.create_index("idx_suggestion_media", "metadata_suggestions", ["media_id"], unique=False)
    op.create_index("idx_suggestion_status", "metadata_suggestions", ["status"], unique=False)
    op.create_index("idx_suggestion_user", "metadata_suggestions", ["user_id"], unique=False)
    op.create_index(op.f("ix_metadata_suggestions_media_id"), "metadata_suggestions", ["media_id"], unique=False)
    op.create_index(op.f("ix_metadata_suggestions_status"), "metadata_suggestions", ["status"], unique=False)
    op.create_index(op.f("ix_metadata_suggestions_updated_at"), "metadata_suggestions", ["updated_at"], unique=False)
    op.create_index(op.f("ix_metadata_suggestions_user_id"), "metadata_suggestions", ["user_id"], unique=False)
    op.create_table(
        "metadata_votes",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("vote_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("vote", sa.Integer(), nullable=True),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "media_id", name="uq_user_metadata_vote"),
    )
    op.create_index("idx_metadata_vote_media", "metadata_votes", ["media_id"], unique=False)
    op.create_index("idx_metadata_vote_user", "metadata_votes", ["user_id"], unique=False)
    op.create_index(op.f("ix_metadata_votes_media_id"), "metadata_votes", ["media_id"], unique=False)
    op.create_index(op.f("ix_metadata_votes_updated_at"), "metadata_votes", ["updated_at"], unique=False)
    op.create_index(op.f("ix_metadata_votes_user_id"), "metadata_votes", ["user_id"], unique=False)
    op.create_table(
        "movie_metadata",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("budget", sa.Integer(), nullable=True),
        sa.Column("revenue", sa.Integer(), nullable=True),
        sa.Column("mpaa_rating", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id"),
    )
    op.create_index(op.f("ix_movie_metadata_media_id"), "movie_metadata", ["media_id"], unique=True)
    op.create_index(op.f("ix_movie_metadata_updated_at"), "movie_metadata", ["updated_at"], unique=False)
    op.create_table(
        "playback_tracking",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=True),
        sa.Column("profile_id", sa.Integer(), nullable=True),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("season", sa.Integer(), nullable=True),
        sa.Column("episode", sa.Integer(), nullable=True),
        sa.Column("provider_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("provider_service", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("first_played_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("last_played_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("play_count", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(["profile_id"], ["user_profiles.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_playback_at", "playback_tracking", ["last_played_at"], unique=False)
    op.create_index("idx_playback_stream", "playback_tracking", ["stream_id"], unique=False)
    op.create_index("idx_playback_user_media", "playback_tracking", ["user_id", "media_id"], unique=False)
    op.create_index("idx_playback_user_stream", "playback_tracking", ["user_id", "stream_id"], unique=False)
    op.create_index(op.f("ix_playback_tracking_media_id"), "playback_tracking", ["media_id"], unique=False)
    op.create_index(op.f("ix_playback_tracking_profile_id"), "playback_tracking", ["profile_id"], unique=False)
    op.create_index(op.f("ix_playback_tracking_stream_id"), "playback_tracking", ["stream_id"], unique=False)
    op.create_index(op.f("ix_playback_tracking_user_id"), "playback_tracking", ["user_id"], unique=False)
    op.create_table(
        "provider_metadata",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("provider_id", sa.Integer(), nullable=False),
        sa.Column("provider_content_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("original_title", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("tagline", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("release_date", sa.DateTime(timezone=True), nullable=True),
        sa.Column("runtime", sa.Integer(), nullable=True),
        sa.Column("popularity", sa.Float(), nullable=True),
        sa.Column("priority", sa.Integer(), nullable=False),
        sa.Column("is_canonical", sa.Boolean(), nullable=False),
        sa.Column("raw_data", sa.JSON(), nullable=True),
        sa.Column("fetched_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_provider_metadata_canonical",
        "provider_metadata",
        ["media_id"],
        unique=False,
        postgresql_where=sa.text("is_canonical = true"),
    )
    op.create_index(
        "idx_provider_metadata_media_provider", "provider_metadata", ["media_id", "provider_id"], unique=False
    )
    op.create_index(op.f("ix_provider_metadata_media_id"), "provider_metadata", ["media_id"], unique=False)
    op.create_table(
        "rss_feed_catalog_pattern",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uuid", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("rss_feed_id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("regex", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("enabled", sa.Boolean(), nullable=False),
        sa.Column("case_sensitive", sa.Boolean(), nullable=False),
        sa.Column("target_catalogs", sa.JSON(), nullable=False),
        sa.ForeignKeyConstraint(["rss_feed_id"], ["rss_feed.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_rss_pattern_feed", "rss_feed_catalog_pattern", ["rss_feed_id"], unique=False)
    op.create_index(
        op.f("ix_rss_feed_catalog_pattern_rss_feed_id"), "rss_feed_catalog_pattern", ["rss_feed_id"], unique=False
    )
    op.create_index(op.f("ix_rss_feed_catalog_pattern_uuid"), "rss_feed_catalog_pattern", ["uuid"], unique=True)
    op.create_table(
        "series_metadata",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("total_seasons", sa.Integer(), nullable=True),
        sa.Column("total_episodes", sa.Integer(), nullable=True),
        sa.Column("network", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id"),
    )
    op.create_index(op.f("ix_series_metadata_media_id"), "series_metadata", ["media_id"], unique=True)
    op.create_index(op.f("ix_series_metadata_updated_at"), "series_metadata", ["updated_at"], unique=False)
    op.create_table(
        "stream_audio_link",
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("audio_format_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["audio_format_id"], ["audio_format.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("stream_id", "audio_format_id"),
    )
    op.create_index(
        op.f("ix_stream_audio_link_audio_format_id"), "stream_audio_link", ["audio_format_id"], unique=False
    )
    op.create_table(
        "stream_channel_link",
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("channel_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["channel_id"], ["audio_channel.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("stream_id", "channel_id"),
    )
    op.create_index(op.f("ix_stream_channel_link_channel_id"), "stream_channel_link", ["channel_id"], unique=False)
    op.create_table(
        "stream_file",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("file_index", sa.Integer(), nullable=True),
        sa.Column("filename", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("file_path", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("size", sa.BigInteger(), nullable=True),
        sa.Column(
            "file_type",
            sa.Enum("VIDEO", "AUDIO", "SUBTITLE", "ARCHIVE", "SAMPLE", "TRAILER", "NFO", "OTHER", name="filetype"),
            nullable=False,
        ),
        sa.Column("is_archive", sa.Boolean(), nullable=False),
        sa.Column("archive_contents", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id", "file_index"),
    )
    op.create_index("idx_stream_file_stream", "stream_file", ["stream_id"], unique=False)
    op.create_index("idx_stream_file_type", "stream_file", ["file_type"], unique=False)
    op.create_index(op.f("ix_stream_file_file_type"), "stream_file", ["file_type"], unique=False)
    op.create_index(op.f("ix_stream_file_stream_id"), "stream_file", ["stream_id"], unique=False)
    op.create_table(
        "stream_hdr_link",
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("hdr_format_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["hdr_format_id"], ["hdr_format.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("stream_id", "hdr_format_id"),
    )
    op.create_index(op.f("ix_stream_hdr_link_hdr_format_id"), "stream_hdr_link", ["hdr_format_id"], unique=False)
    op.create_table(
        "stream_language_link",
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("language_id", sa.Integer(), nullable=False),
        sa.Column("language_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.ForeignKeyConstraint(["language_id"], ["language.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("stream_id", "language_id"),
    )
    op.create_index(op.f("ix_stream_language_link_language_id"), "stream_language_link", ["language_id"], unique=False)
    op.create_table(
        "stream_media_link",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("linked_by_user_id", sa.Integer(), nullable=True),
        sa.Column("file_index", sa.Integer(), nullable=True),
        sa.Column("filename", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("file_size", sa.BigInteger(), nullable=True),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("is_verified", sa.Boolean(), nullable=False),
        sa.Column("confidence_score", sa.Float(), nullable=True),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["linked_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_stream_media_link_media_stream", "stream_media_link", ["media_id", "stream_id"], unique=False)
    op.create_index("idx_stream_media_media", "stream_media_link", ["media_id"], unique=False)
    op.create_index("idx_stream_media_primary", "stream_media_link", ["stream_id", "is_primary"], unique=False)
    op.create_index("idx_stream_media_stream", "stream_media_link", ["stream_id"], unique=False)
    op.create_index("idx_stream_media_user", "stream_media_link", ["linked_by_user_id"], unique=False)
    op.create_table(
        "stream_suggestions",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("suggestion_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("current_value", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("suggested_value", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("reason", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("status", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("reviewed_by", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("review_notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_stream_suggestion_status", "stream_suggestions", ["status"], unique=False)
    op.create_index("idx_stream_suggestion_stream", "stream_suggestions", ["stream_id"], unique=False)
    op.create_index("idx_stream_suggestion_type", "stream_suggestions", ["suggestion_type"], unique=False)
    op.create_index("idx_stream_suggestion_user", "stream_suggestions", ["user_id"], unique=False)
    op.create_index(op.f("ix_stream_suggestions_status"), "stream_suggestions", ["status"], unique=False)
    op.create_index(op.f("ix_stream_suggestions_stream_id"), "stream_suggestions", ["stream_id"], unique=False)
    op.create_index(op.f("ix_stream_suggestions_updated_at"), "stream_suggestions", ["updated_at"], unique=False)
    op.create_index(op.f("ix_stream_suggestions_user_id"), "stream_suggestions", ["user_id"], unique=False)
    op.create_table(
        "stream_votes",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("vote_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("quality_status", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("comment", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["stream_id"], ["stream.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "stream_id", name="uq_user_stream_vote"),
    )
    op.create_index("idx_stream_vote_stream", "stream_votes", ["stream_id"], unique=False)
    op.create_index("idx_stream_vote_type", "stream_votes", ["vote_type"], unique=False)
    op.create_index("idx_stream_vote_user", "stream_votes", ["user_id"], unique=False)
    op.create_index(op.f("ix_stream_votes_stream_id"), "stream_votes", ["stream_id"], unique=False)
    op.create_index(op.f("ix_stream_votes_updated_at"), "stream_votes", ["updated_at"], unique=False)
    op.create_index(op.f("ix_stream_votes_user_id"), "stream_votes", ["user_id"], unique=False)
    op.create_index(op.f("ix_stream_votes_vote_type"), "stream_votes", ["vote_type"], unique=False)
    op.create_table(
        "telegram_stream",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("chat_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("chat_username", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("message_id", sa.Integer(), nullable=False),
        sa.Column("file_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("size", sa.BigInteger(), nullable=True),
        sa.Column("mime_type", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("file_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("posted_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index("idx_telegram_chat_message", "telegram_stream", ["chat_id", "message_id"], unique=False)
    op.create_index(op.f("ix_telegram_stream_stream_id"), "telegram_stream", ["stream_id"], unique=True)
    op.create_table(
        "torrent_stream",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("info_hash", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("total_size", sa.BigInteger(), nullable=False),
        sa.Column("seeders", sa.Integer(), nullable=True),
        sa.Column("leechers", sa.Integer(), nullable=True),
        sa.Column(
            "torrent_type", sa.Enum("PUBLIC", "SEMI_PRIVATE", "PRIVATE", "WEB_SEED", name="torrenttype"), nullable=False
        ),
        sa.Column("uploaded_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("torrent_file", sa.LargeBinary(), nullable=True),
        sa.Column("file_count", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index("idx_torrent_info_hash", "torrent_stream", ["info_hash"], unique=False)
    op.create_index("idx_torrent_seeders", "torrent_stream", ["seeders"], unique=False)
    op.create_index(op.f("ix_torrent_stream_info_hash"), "torrent_stream", ["info_hash"], unique=True)
    op.create_index(op.f("ix_torrent_stream_stream_id"), "torrent_stream", ["stream_id"], unique=True)
    op.create_index(op.f("ix_torrent_stream_updated_at"), "torrent_stream", ["updated_at"], unique=False)
    op.create_table(
        "tv_metadata",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("country", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("tv_language", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("media_id"),
    )
    op.create_index(op.f("ix_tv_metadata_country"), "tv_metadata", ["country"], unique=False)
    op.create_index(op.f("ix_tv_metadata_media_id"), "tv_metadata", ["media_id"], unique=True)
    op.create_index(op.f("ix_tv_metadata_tv_language"), "tv_metadata", ["tv_language"], unique=False)
    op.create_index(op.f("ix_tv_metadata_updated_at"), "tv_metadata", ["updated_at"], unique=False)
    op.create_table(
        "usenet_stream",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("nzb_guid", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("nzb_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("nzb_content", sa.LargeBinary(), nullable=True),
        sa.Column("size", sa.BigInteger(), nullable=False),
        sa.Column("indexer", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("group_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("uploader", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("files_count", sa.Integer(), nullable=True),
        sa.Column("parts_count", sa.Integer(), nullable=True),
        sa.Column("posted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("is_passworded", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index("idx_usenet_guid", "usenet_stream", ["nzb_guid"], unique=False)
    op.create_index(op.f("ix_usenet_stream_indexer"), "usenet_stream", ["indexer"], unique=False)
    op.create_index(op.f("ix_usenet_stream_nzb_guid"), "usenet_stream", ["nzb_guid"], unique=True)
    op.create_index(op.f("ix_usenet_stream_stream_id"), "usenet_stream", ["stream_id"], unique=True)
    op.create_table(
        "user_catalog_item",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("catalog_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.Column("notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("added_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(["catalog_id"], ["user_catalog.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("catalog_id", "media_id"),
    )
    op.create_index("idx_catalog_item_catalog", "user_catalog_item", ["catalog_id"], unique=False)
    op.create_index("idx_catalog_item_media", "user_catalog_item", ["media_id"], unique=False)
    op.create_index("idx_catalog_item_order", "user_catalog_item", ["catalog_id", "display_order"], unique=False)
    op.create_index(op.f("ix_user_catalog_item_catalog_id"), "user_catalog_item", ["catalog_id"], unique=False)
    op.create_index(op.f("ix_user_catalog_item_display_order"), "user_catalog_item", ["display_order"], unique=False)
    op.create_index(op.f("ix_user_catalog_item_media_id"), "user_catalog_item", ["media_id"], unique=False)
    op.create_table(
        "user_catalog_subscription",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("catalog_id", sa.Integer(), nullable=False),
        sa.Column("subscribed_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(["catalog_id"], ["user_catalog.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "catalog_id"),
    )
    op.create_index("idx_subscription_catalog", "user_catalog_subscription", ["catalog_id"], unique=False)
    op.create_index("idx_subscription_user", "user_catalog_subscription", ["user_id"], unique=False)
    op.create_index(
        op.f("ix_user_catalog_subscription_catalog_id"), "user_catalog_subscription", ["catalog_id"], unique=False
    )
    op.create_index(
        op.f("ix_user_catalog_subscription_user_id"), "user_catalog_subscription", ["user_id"], unique=False
    )
    op.create_table(
        "user_library_item",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("catalog_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("title_cached", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("poster_cached", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("added_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "media_id"),
    )
    op.create_index("idx_library_added", "user_library_item", ["added_at"], unique=False)
    op.create_index("idx_library_media", "user_library_item", ["media_id"], unique=False)
    op.create_index("idx_library_type", "user_library_item", ["catalog_type"], unique=False)
    op.create_index("idx_library_user", "user_library_item", ["user_id"], unique=False)
    op.create_index(op.f("ix_user_library_item_media_id"), "user_library_item", ["media_id"], unique=False)
    op.create_index(op.f("ix_user_library_item_user_id"), "user_library_item", ["user_id"], unique=False)
    op.create_table(
        "watch_history",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("profile_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("media_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("season", sa.Integer(), nullable=True),
        sa.Column("episode", sa.Integer(), nullable=True),
        sa.Column("progress", sa.Integer(), nullable=False),
        sa.Column("duration", sa.Integer(), nullable=True),
        sa.Column("watched_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["media_id"],
            ["media.id"],
        ),
        sa.ForeignKeyConstraint(["profile_id"], ["user_profiles.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["user_id"], ["users.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("idx_watch_profile_media", "watch_history", ["profile_id", "media_id"], unique=False)
    op.create_index("idx_watch_user_media", "watch_history", ["user_id", "media_id"], unique=False)
    op.create_index("idx_watch_watched_at", "watch_history", ["watched_at"], unique=False)
    op.create_index(op.f("ix_watch_history_media_id"), "watch_history", ["media_id"], unique=False)
    op.create_index(op.f("ix_watch_history_profile_id"), "watch_history", ["profile_id"], unique=False)
    op.create_index(op.f("ix_watch_history_user_id"), "watch_history", ["user_id"], unique=False)
    op.create_table(
        "youtube_stream",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("stream_id", sa.Integer(), nullable=False),
        sa.Column("video_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("channel_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("channel_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("duration_seconds", sa.Integer(), nullable=True),
        sa.Column("is_live", sa.Boolean(), nullable=False),
        sa.Column("is_premiere", sa.Boolean(), nullable=False),
        sa.Column("published_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["stream_id"],
            ["stream.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("stream_id"),
    )
    op.create_index("idx_youtube_video_id", "youtube_stream", ["video_id"], unique=False)
    op.create_index(op.f("ix_youtube_stream_stream_id"), "youtube_stream", ["stream_id"], unique=True)
    op.create_index(op.f("ix_youtube_stream_video_id"), "youtube_stream", ["video_id"], unique=True)
    op.create_table(
        "file_media_link",
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("file_id", sa.Integer(), nullable=False),
        sa.Column("media_id", sa.Integer(), nullable=False),
        sa.Column("season_number", sa.Integer(), nullable=True),
        sa.Column("episode_number", sa.Integer(), nullable=True),
        sa.Column("episode_end", sa.Integer(), nullable=True),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("confidence", sa.Float(), nullable=False),
        sa.Column(
            "link_source",
            sa.Enum(
                "USER",
                "PTT_PARSER",
                "TORRENT_METADATA",
                "DEBRID_REALDEBRID",
                "DEBRID_ALLDEBRID",
                "DEBRID_PREMIUMIZE",
                "DEBRID_TORBOX",
                "DEBRID_DEBRIDLINK",
                "MANUAL",
                "FILENAME",
                name="linksource",
            ),
            nullable=False,
        ),
        sa.Column("debrid_service", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(["file_id"], ["stream_file.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["media_id"], ["media.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("file_id", "media_id", "season_number", "episode_number"),
    )
    op.create_index(
        "idx_file_media_link_episode", "file_media_link", ["media_id", "season_number", "episode_number"], unique=False
    )
    op.create_index("idx_file_media_link_file", "file_media_link", ["file_id"], unique=False)
    op.create_index("idx_file_media_link_file_episode", "file_media_link", ["file_id", "episode_number"], unique=False)
    op.create_index("idx_file_media_link_media", "file_media_link", ["media_id"], unique=False)
    op.create_index(op.f("ix_file_media_link_file_id"), "file_media_link", ["file_id"], unique=False)
    op.create_index(op.f("ix_file_media_link_media_id"), "file_media_link", ["media_id"], unique=False)
    op.create_index(op.f("ix_file_media_link_updated_at"), "file_media_link", ["updated_at"], unique=False)
    op.create_table(
        "season",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("series_id", sa.Integer(), nullable=False),
        sa.Column("season_number", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("overview", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("air_date", sa.Date(), nullable=True),
        sa.Column("episode_count", sa.Integer(), nullable=False),
        sa.Column("provider_id", sa.Integer(), nullable=True),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.ForeignKeyConstraint(
            ["series_id"],
            ["series_metadata.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("series_id", "season_number"),
    )
    op.create_index(op.f("ix_season_season_number"), "season", ["season_number"], unique=False)
    op.create_index(op.f("ix_season_series_id"), "season", ["series_id"], unique=False)
    op.create_table(
        "torrent_tracker_link",
        sa.Column("torrent_id", sa.Integer(), nullable=False),
        sa.Column("tracker_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["torrent_id"], ["torrent_stream.id"], ondelete="CASCADE"),
        sa.ForeignKeyConstraint(["tracker_id"], ["tracker.id"], ondelete="CASCADE"),
        sa.PrimaryKeyConstraint("torrent_id", "tracker_id"),
    )
    op.create_index(op.f("ix_torrent_tracker_link_tracker_id"), "torrent_tracker_link", ["tracker_id"], unique=False)
    op.create_table(
        "episode",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("season_id", sa.Integer(), nullable=False),
        sa.Column("episode_number", sa.Integer(), nullable=False),
        sa.Column("title", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("overview", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("air_date", sa.Date(), nullable=True),
        sa.Column("runtime_minutes", sa.Integer(), nullable=True),
        sa.Column("imdb_id", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("tmdb_id", sa.Integer(), nullable=True),
        sa.Column("tvdb_id", sa.Integer(), nullable=True),
        sa.Column("provider_id", sa.Integer(), nullable=True),
        sa.Column("source_provider_id", sa.Integer(), nullable=True),
        sa.Column("created_by_user_id", sa.Integer(), nullable=True),
        sa.Column("is_user_created", sa.Boolean(), nullable=False),
        sa.Column("is_user_addition", sa.Boolean(), nullable=False),
        sa.Column("created_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("updated_at", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["created_by_user_id"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.ForeignKeyConstraint(
            ["season_id"],
            ["season.id"],
        ),
        sa.ForeignKeyConstraint(
            ["source_provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("season_id", "episode_number"),
    )
    op.create_index("idx_episode_external_ids", "episode", ["imdb_id", "tmdb_id", "tvdb_id"], unique=False)
    op.create_index(
        "idx_episode_user_addition",
        "episode",
        ["is_user_addition"],
        unique=False,
        postgresql_where="is_user_addition = true",
    )
    op.create_index(
        "idx_episode_user_created",
        "episode",
        ["is_user_created"],
        unique=False,
        postgresql_where="is_user_created = true",
    )
    op.create_index(op.f("ix_episode_episode_number"), "episode", ["episode_number"], unique=False)
    op.create_index(op.f("ix_episode_imdb_id"), "episode", ["imdb_id"], unique=False)
    op.create_index(op.f("ix_episode_is_user_addition"), "episode", ["is_user_addition"], unique=False)
    op.create_index(op.f("ix_episode_is_user_created"), "episode", ["is_user_created"], unique=False)
    op.create_index(op.f("ix_episode_season_id"), "episode", ["season_id"], unique=False)
    op.create_index(op.f("ix_episode_tmdb_id"), "episode", ["tmdb_id"], unique=False)
    op.create_index(op.f("ix_episode_tvdb_id"), "episode", ["tvdb_id"], unique=False)
    op.create_table(
        "episode_image",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("episode_id", sa.Integer(), nullable=False),
        sa.Column("provider_id", sa.Integer(), nullable=False),
        sa.Column("image_type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("language", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("aspect_ratio", sa.Float(), nullable=True),
        sa.Column("width", sa.Integer(), nullable=True),
        sa.Column("height", sa.Integer(), nullable=True),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(
            ["episode_id"],
            ["episode.id"],
        ),
        sa.ForeignKeyConstraint(
            ["provider_id"],
            ["metadata_provider.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("episode_id", "provider_id", "image_type", "url", name="uq_episode_image"),
    )
    op.create_index("idx_episode_image_episode", "episode_image", ["episode_id"], unique=False)
    op.create_index(op.f("ix_episode_image_episode_id"), "episode_image", ["episode_id"], unique=False)
    op.create_index(op.f("ix_episode_image_is_primary"), "episode_image", ["is_primary"], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_episode_image_is_primary"), table_name="episode_image")
    op.drop_index(op.f("ix_episode_image_episode_id"), table_name="episode_image")
    op.drop_index("idx_episode_image_episode", table_name="episode_image")
    op.drop_table("episode_image")
    op.drop_index(op.f("ix_episode_tvdb_id"), table_name="episode")
    op.drop_index(op.f("ix_episode_tmdb_id"), table_name="episode")
    op.drop_index(op.f("ix_episode_season_id"), table_name="episode")
    op.drop_index(op.f("ix_episode_is_user_created"), table_name="episode")
    op.drop_index(op.f("ix_episode_is_user_addition"), table_name="episode")
    op.drop_index(op.f("ix_episode_imdb_id"), table_name="episode")
    op.drop_index(op.f("ix_episode_episode_number"), table_name="episode")
    op.drop_index("idx_episode_user_created", table_name="episode", postgresql_where="is_user_created = true")
    op.drop_index("idx_episode_user_addition", table_name="episode", postgresql_where="is_user_addition = true")
    op.drop_index("idx_episode_external_ids", table_name="episode")
    op.drop_table("episode")
    op.drop_index(op.f("ix_torrent_tracker_link_tracker_id"), table_name="torrent_tracker_link")
    op.drop_table("torrent_tracker_link")
    op.drop_index(op.f("ix_season_series_id"), table_name="season")
    op.drop_index(op.f("ix_season_season_number"), table_name="season")
    op.drop_table("season")
    op.drop_index(op.f("ix_file_media_link_updated_at"), table_name="file_media_link")
    op.drop_index(op.f("ix_file_media_link_media_id"), table_name="file_media_link")
    op.drop_index(op.f("ix_file_media_link_file_id"), table_name="file_media_link")
    op.drop_index("idx_file_media_link_media", table_name="file_media_link")
    op.drop_index("idx_file_media_link_file_episode", table_name="file_media_link")
    op.drop_index("idx_file_media_link_file", table_name="file_media_link")
    op.drop_index("idx_file_media_link_episode", table_name="file_media_link")
    op.drop_table("file_media_link")
    op.drop_index(op.f("ix_youtube_stream_video_id"), table_name="youtube_stream")
    op.drop_index(op.f("ix_youtube_stream_stream_id"), table_name="youtube_stream")
    op.drop_index("idx_youtube_video_id", table_name="youtube_stream")
    op.drop_table("youtube_stream")
    op.drop_index(op.f("ix_watch_history_user_id"), table_name="watch_history")
    op.drop_index(op.f("ix_watch_history_profile_id"), table_name="watch_history")
    op.drop_index(op.f("ix_watch_history_media_id"), table_name="watch_history")
    op.drop_index("idx_watch_watched_at", table_name="watch_history")
    op.drop_index("idx_watch_user_media", table_name="watch_history")
    op.drop_index("idx_watch_profile_media", table_name="watch_history")
    op.drop_table("watch_history")
    op.drop_index(op.f("ix_user_library_item_user_id"), table_name="user_library_item")
    op.drop_index(op.f("ix_user_library_item_media_id"), table_name="user_library_item")
    op.drop_index("idx_library_user", table_name="user_library_item")
    op.drop_index("idx_library_type", table_name="user_library_item")
    op.drop_index("idx_library_media", table_name="user_library_item")
    op.drop_index("idx_library_added", table_name="user_library_item")
    op.drop_table("user_library_item")
    op.drop_index(op.f("ix_user_catalog_subscription_user_id"), table_name="user_catalog_subscription")
    op.drop_index(op.f("ix_user_catalog_subscription_catalog_id"), table_name="user_catalog_subscription")
    op.drop_index("idx_subscription_user", table_name="user_catalog_subscription")
    op.drop_index("idx_subscription_catalog", table_name="user_catalog_subscription")
    op.drop_table("user_catalog_subscription")
    op.drop_index(op.f("ix_user_catalog_item_media_id"), table_name="user_catalog_item")
    op.drop_index(op.f("ix_user_catalog_item_display_order"), table_name="user_catalog_item")
    op.drop_index(op.f("ix_user_catalog_item_catalog_id"), table_name="user_catalog_item")
    op.drop_index("idx_catalog_item_order", table_name="user_catalog_item")
    op.drop_index("idx_catalog_item_media", table_name="user_catalog_item")
    op.drop_index("idx_catalog_item_catalog", table_name="user_catalog_item")
    op.drop_table("user_catalog_item")
    op.drop_index(op.f("ix_usenet_stream_stream_id"), table_name="usenet_stream")
    op.drop_index(op.f("ix_usenet_stream_nzb_guid"), table_name="usenet_stream")
    op.drop_index(op.f("ix_usenet_stream_indexer"), table_name="usenet_stream")
    op.drop_index("idx_usenet_guid", table_name="usenet_stream")
    op.drop_table("usenet_stream")
    op.drop_index(op.f("ix_tv_metadata_updated_at"), table_name="tv_metadata")
    op.drop_index(op.f("ix_tv_metadata_tv_language"), table_name="tv_metadata")
    op.drop_index(op.f("ix_tv_metadata_media_id"), table_name="tv_metadata")
    op.drop_index(op.f("ix_tv_metadata_country"), table_name="tv_metadata")
    op.drop_table("tv_metadata")
    op.drop_index(op.f("ix_torrent_stream_updated_at"), table_name="torrent_stream")
    op.drop_index(op.f("ix_torrent_stream_stream_id"), table_name="torrent_stream")
    op.drop_index(op.f("ix_torrent_stream_info_hash"), table_name="torrent_stream")
    op.drop_index("idx_torrent_seeders", table_name="torrent_stream")
    op.drop_index("idx_torrent_info_hash", table_name="torrent_stream")
    op.drop_table("torrent_stream")
    op.drop_index(op.f("ix_telegram_stream_stream_id"), table_name="telegram_stream")
    op.drop_index("idx_telegram_chat_message", table_name="telegram_stream")
    op.drop_table("telegram_stream")
    op.drop_index(op.f("ix_stream_votes_vote_type"), table_name="stream_votes")
    op.drop_index(op.f("ix_stream_votes_user_id"), table_name="stream_votes")
    op.drop_index(op.f("ix_stream_votes_updated_at"), table_name="stream_votes")
    op.drop_index(op.f("ix_stream_votes_stream_id"), table_name="stream_votes")
    op.drop_index("idx_stream_vote_user", table_name="stream_votes")
    op.drop_index("idx_stream_vote_type", table_name="stream_votes")
    op.drop_index("idx_stream_vote_stream", table_name="stream_votes")
    op.drop_table("stream_votes")
    op.drop_index(op.f("ix_stream_suggestions_user_id"), table_name="stream_suggestions")
    op.drop_index(op.f("ix_stream_suggestions_updated_at"), table_name="stream_suggestions")
    op.drop_index(op.f("ix_stream_suggestions_stream_id"), table_name="stream_suggestions")
    op.drop_index(op.f("ix_stream_suggestions_status"), table_name="stream_suggestions")
    op.drop_index("idx_stream_suggestion_user", table_name="stream_suggestions")
    op.drop_index("idx_stream_suggestion_type", table_name="stream_suggestions")
    op.drop_index("idx_stream_suggestion_stream", table_name="stream_suggestions")
    op.drop_index("idx_stream_suggestion_status", table_name="stream_suggestions")
    op.drop_table("stream_suggestions")
    op.drop_index("idx_stream_media_user", table_name="stream_media_link")
    op.drop_index("idx_stream_media_stream", table_name="stream_media_link")
    op.drop_index("idx_stream_media_primary", table_name="stream_media_link")
    op.drop_index("idx_stream_media_media", table_name="stream_media_link")
    op.drop_index("idx_stream_media_link_media_stream", table_name="stream_media_link")
    op.drop_table("stream_media_link")
    op.drop_index(op.f("ix_stream_language_link_language_id"), table_name="stream_language_link")
    op.drop_table("stream_language_link")
    op.drop_index(op.f("ix_stream_hdr_link_hdr_format_id"), table_name="stream_hdr_link")
    op.drop_table("stream_hdr_link")
    op.drop_index(op.f("ix_stream_file_stream_id"), table_name="stream_file")
    op.drop_index(op.f("ix_stream_file_file_type"), table_name="stream_file")
    op.drop_index("idx_stream_file_type", table_name="stream_file")
    op.drop_index("idx_stream_file_stream", table_name="stream_file")
    op.drop_table("stream_file")
    op.drop_index(op.f("ix_stream_channel_link_channel_id"), table_name="stream_channel_link")
    op.drop_table("stream_channel_link")
    op.drop_index(op.f("ix_stream_audio_link_audio_format_id"), table_name="stream_audio_link")
    op.drop_table("stream_audio_link")
    op.drop_index(op.f("ix_series_metadata_updated_at"), table_name="series_metadata")
    op.drop_index(op.f("ix_series_metadata_media_id"), table_name="series_metadata")
    op.drop_table("series_metadata")
    op.drop_index(op.f("ix_rss_feed_catalog_pattern_uuid"), table_name="rss_feed_catalog_pattern")
    op.drop_index(op.f("ix_rss_feed_catalog_pattern_rss_feed_id"), table_name="rss_feed_catalog_pattern")
    op.drop_index("idx_rss_pattern_feed", table_name="rss_feed_catalog_pattern")
    op.drop_table("rss_feed_catalog_pattern")
    op.drop_index(op.f("ix_provider_metadata_media_id"), table_name="provider_metadata")
    op.drop_index("idx_provider_metadata_media_provider", table_name="provider_metadata")
    op.drop_index(
        "idx_provider_metadata_canonical",
        table_name="provider_metadata",
        postgresql_where=sa.text("is_canonical = true"),
    )
    op.drop_table("provider_metadata")
    op.drop_index(op.f("ix_playback_tracking_user_id"), table_name="playback_tracking")
    op.drop_index(op.f("ix_playback_tracking_stream_id"), table_name="playback_tracking")
    op.drop_index(op.f("ix_playback_tracking_profile_id"), table_name="playback_tracking")
    op.drop_index(op.f("ix_playback_tracking_media_id"), table_name="playback_tracking")
    op.drop_index("idx_playback_user_stream", table_name="playback_tracking")
    op.drop_index("idx_playback_user_media", table_name="playback_tracking")
    op.drop_index("idx_playback_stream", table_name="playback_tracking")
    op.drop_index("idx_playback_at", table_name="playback_tracking")
    op.drop_table("playback_tracking")
    op.drop_index(op.f("ix_movie_metadata_updated_at"), table_name="movie_metadata")
    op.drop_index(op.f("ix_movie_metadata_media_id"), table_name="movie_metadata")
    op.drop_table("movie_metadata")
    op.drop_index(op.f("ix_metadata_votes_user_id"), table_name="metadata_votes")
    op.drop_index(op.f("ix_metadata_votes_updated_at"), table_name="metadata_votes")
    op.drop_index(op.f("ix_metadata_votes_media_id"), table_name="metadata_votes")
    op.drop_index("idx_metadata_vote_user", table_name="metadata_votes")
    op.drop_index("idx_metadata_vote_media", table_name="metadata_votes")
    op.drop_table("metadata_votes")
    op.drop_index(op.f("ix_metadata_suggestions_user_id"), table_name="metadata_suggestions")
    op.drop_index(op.f("ix_metadata_suggestions_updated_at"), table_name="metadata_suggestions")
    op.drop_index(op.f("ix_metadata_suggestions_status"), table_name="metadata_suggestions")
    op.drop_index(op.f("ix_metadata_suggestions_media_id"), table_name="metadata_suggestions")
    op.drop_index("idx_suggestion_user", table_name="metadata_suggestions")
    op.drop_index("idx_suggestion_status", table_name="metadata_suggestions")
    op.drop_index("idx_suggestion_media", table_name="metadata_suggestions")
    op.drop_index("idx_suggestion_field", table_name="metadata_suggestions")
    op.drop_table("metadata_suggestions")
    op.drop_index(op.f("ix_mediafusion_rating_media_id"), table_name="mediafusion_rating")
    op.drop_table("mediafusion_rating")
    op.drop_index(op.f("ix_media_trailer_updated_at"), table_name="media_trailer")
    op.drop_index(op.f("ix_media_trailer_media_id"), table_name="media_trailer")
    op.drop_index("idx_media_trailer_type", table_name="media_trailer")
    op.drop_index("idx_media_trailer_media", table_name="media_trailer")
    op.drop_table("media_trailer")
    op.drop_index(op.f("ix_media_review_updated_at"), table_name="media_review")
    op.drop_index(op.f("ix_media_review_media_id"), table_name="media_review")
    op.drop_index("idx_media_review_user", table_name="media_review")
    op.drop_index("idx_media_review_provider", table_name="media_review")
    op.drop_index("idx_media_review_media", table_name="media_review")
    op.drop_table("media_review")
    op.drop_index(op.f("ix_media_rating_media_id"), table_name="media_rating")
    op.drop_table("media_rating")
    op.drop_index(op.f("ix_media_production_company_link_company_id"), table_name="media_production_company_link")
    op.drop_table("media_production_company_link")
    op.drop_index(
        op.f("ix_media_parental_certificate_link_certificate_id"), table_name="media_parental_certificate_link"
    )
    op.drop_table("media_parental_certificate_link")
    op.drop_index(op.f("ix_media_keyword_link_keyword_id"), table_name="media_keyword_link")
    op.drop_table("media_keyword_link")
    op.drop_index(op.f("ix_media_image_media_id"), table_name="media_image")
    op.drop_index(op.f("ix_media_image_is_primary"), table_name="media_image")
    op.drop_index(op.f("ix_media_image_image_type"), table_name="media_image")
    op.drop_table("media_image")
    op.drop_index(op.f("ix_media_genre_link_genre_id"), table_name="media_genre_link")
    op.drop_table("media_genre_link")
    op.drop_index(op.f("ix_media_external_id_updated_at"), table_name="media_external_id")
    op.drop_index(op.f("ix_media_external_id_provider"), table_name="media_external_id")
    op.drop_index(op.f("ix_media_external_id_media_id"), table_name="media_external_id")
    op.drop_index("idx_media_external_provider_id", table_name="media_external_id")
    op.drop_index("idx_media_external_media", table_name="media_external_id")
    op.drop_table("media_external_id")
    op.drop_index(op.f("ix_media_crew_person_id"), table_name="media_crew")
    op.drop_index(op.f("ix_media_crew_media_id"), table_name="media_crew")
    op.drop_index("idx_media_crew_person", table_name="media_crew")
    op.drop_index("idx_media_crew_media", table_name="media_crew")
    op.drop_index("idx_media_crew_department", table_name="media_crew")
    op.drop_table("media_crew")
    op.drop_index(op.f("ix_media_catalog_link_catalog_id"), table_name="media_catalog_link")
    op.drop_table("media_catalog_link")
    op.drop_index(op.f("ix_media_cast_person_id"), table_name="media_cast")
    op.drop_index(op.f("ix_media_cast_media_id"), table_name="media_cast")
    op.drop_index("idx_media_cast_person", table_name="media_cast")
    op.drop_index("idx_media_cast_order", table_name="media_cast")
    op.drop_index("idx_media_cast_media", table_name="media_cast")
    op.drop_table("media_cast")
    op.drop_index(op.f("ix_http_stream_stream_id"), table_name="http_stream")
    op.drop_table("http_stream")
    op.drop_index(op.f("ix_external_link_stream_stream_id"), table_name="external_link_stream")
    op.drop_table("external_link_stream")
    op.drop_index(op.f("ix_download_history_user_id"), table_name="download_history")
    op.drop_index(op.f("ix_download_history_profile_id"), table_name="download_history")
    op.drop_index(op.f("ix_download_history_media_id"), table_name="download_history")
    op.drop_index("idx_download_user", table_name="download_history")
    op.drop_index("idx_download_profile", table_name="download_history")
    op.drop_index("idx_download_at", table_name="download_history")
    op.drop_table("download_history")
    op.drop_index(op.f("ix_aka_title_title"), table_name="aka_title")
    op.drop_index(op.f("ix_aka_title_media_id"), table_name="aka_title")
    op.drop_index(
        "idx_aka_title_trgm", table_name="aka_title", postgresql_using="gin", postgresql_ops={"title": "gin_trgm_ops"}
    )
    op.drop_index("idx_aka_title_fts", table_name="aka_title", postgresql_using="gin")
    op.drop_table("aka_title")
    op.drop_index(op.f("ix_user_profiles_uuid"), table_name="user_profiles")
    op.drop_index(op.f("ix_user_profiles_user_id"), table_name="user_profiles")
    op.drop_index(op.f("ix_user_profiles_updated_at"), table_name="user_profiles")
    op.drop_index("idx_profile_user_default", table_name="user_profiles")
    op.drop_table("user_profiles")
    op.drop_index(op.f("ix_user_catalog_user_id"), table_name="user_catalog")
    op.drop_index(op.f("ix_user_catalog_updated_at"), table_name="user_catalog")
    op.drop_index(op.f("ix_user_catalog_share_code"), table_name="user_catalog")
    op.drop_index(op.f("ix_user_catalog_is_public"), table_name="user_catalog")
    op.drop_index(op.f("ix_user_catalog_is_listed"), table_name="user_catalog")
    op.drop_index("idx_user_catalog_public", table_name="user_catalog")
    op.drop_index("idx_user_catalog_owner", table_name="user_catalog")
    op.drop_index("idx_user_catalog_listed", table_name="user_catalog")
    op.drop_table("user_catalog")
    op.drop_index(op.f("ix_stream_uploader"), table_name="stream")
    op.drop_index(op.f("ix_stream_updated_at"), table_name="stream")
    op.drop_index(op.f("ix_stream_resolution"), table_name="stream")
    op.drop_index(op.f("ix_stream_release_group"), table_name="stream")
    op.drop_index(op.f("ix_stream_quality"), table_name="stream")
    op.drop_index(op.f("ix_stream_codec"), table_name="stream")
    op.drop_index(op.f("ix_stream_bit_depth"), table_name="stream")
    op.drop_index("idx_stream_uploader_user", table_name="stream", postgresql_where="uploader_user_id IS NOT NULL")
    op.drop_index("idx_stream_type", table_name="stream")
    op.drop_index("idx_stream_source", table_name="stream")
    op.drop_index("idx_stream_public", table_name="stream")
    op.drop_index("idx_stream_blocked", table_name="stream")
    op.drop_index("idx_stream_active_blocked", table_name="stream")
    op.drop_index("idx_stream_active", table_name="stream")
    op.drop_table("stream")
    op.drop_index(op.f("ix_rss_feed_uuid"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_user_id"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_updated_at"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_source"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_name"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_is_public"), table_name="rss_feed")
    op.drop_index(op.f("ix_rss_feed_is_active"), table_name="rss_feed")
    op.drop_index("idx_rss_feed_user", table_name="rss_feed")
    op.drop_index("idx_rss_feed_source", table_name="rss_feed")
    op.drop_index("idx_rss_feed_public", table_name="rss_feed")
    op.drop_index("idx_rss_feed_active", table_name="rss_feed")
    op.drop_table("rss_feed")
    op.drop_index(op.f("ix_person_updated_at"), table_name="person")
    op.drop_index(op.f("ix_person_tmdb_id"), table_name="person")
    op.drop_index(op.f("ix_person_name"), table_name="person")
    op.drop_index(op.f("ix_person_imdb_id"), table_name="person")
    op.drop_index("idx_person_tmdb", table_name="person")
    op.drop_index(
        "idx_person_name_trgm", table_name="person", postgresql_using="gin", postgresql_ops={"name": "gin_trgm_ops"}
    )
    op.drop_index("idx_person_name", table_name="person")
    op.drop_index("idx_person_imdb", table_name="person")
    op.drop_table("person")
    op.drop_index(op.f("ix_media_year"), table_name="media")
    op.drop_index(op.f("ix_media_updated_at"), table_name="media")
    op.drop_index(op.f("ix_media_type"), table_name="media")
    op.drop_index(op.f("ix_media_total_streams"), table_name="media")
    op.drop_index(op.f("ix_media_nudity_status"), table_name="media")
    op.drop_index(op.f("ix_media_last_stream_added"), table_name="media")
    op.drop_index(op.f("ix_media_is_user_created"), table_name="media")
    op.drop_index(op.f("ix_media_is_blocked"), table_name="media")
    op.drop_index("idx_media_user_created", table_name="media")
    op.drop_index("idx_media_type_title", table_name="media")
    op.drop_index(
        "idx_media_title_trgm", table_name="media", postgresql_using="gin", postgresql_ops={"title": "gin_trgm_ops"}
    )
    op.drop_index("idx_media_title_fts", table_name="media", postgresql_using="gin")
    op.drop_index("idx_media_last_stream_added_type", table_name="media")
    op.drop_index("idx_media_last_stream_added", table_name="media")
    op.drop_index("idx_media_created_by_user", table_name="media")
    op.drop_index("idx_media_blocked", table_name="media", postgresql_where="is_blocked = true")
    op.drop_table("media")
    op.drop_index(op.f("ix_iptv_source_updated_at"), table_name="iptv_source")
    op.drop_index("idx_iptv_source_user", table_name="iptv_source")
    op.drop_index("idx_iptv_source_type", table_name="iptv_source")
    op.drop_index("idx_iptv_source_active", table_name="iptv_source")
    op.drop_table("iptv_source")
    op.drop_index(op.f("ix_contributions_user_id"), table_name="contributions")
    op.drop_index(op.f("ix_contributions_updated_at"), table_name="contributions")
    op.drop_index(op.f("ix_contributions_target_id"), table_name="contributions")
    op.drop_index(op.f("ix_contributions_status"), table_name="contributions")
    op.drop_index(op.f("ix_contributions_contribution_type"), table_name="contributions")
    op.drop_index("idx_contribution_user", table_name="contributions")
    op.drop_index("idx_contribution_type", table_name="contributions")
    op.drop_index("idx_contribution_status", table_name="contributions")
    op.drop_table("contributions")
    op.drop_index(op.f("ix_users_uuid"), table_name="users")
    op.drop_index(op.f("ix_users_username"), table_name="users")
    op.drop_index(op.f("ix_users_updated_at"), table_name="users")
    op.drop_index(op.f("ix_users_role"), table_name="users")
    op.drop_index(op.f("ix_users_is_active"), table_name="users")
    op.drop_index(op.f("ix_users_email"), table_name="users")
    op.drop_index(op.f("ix_users_contribution_points"), table_name="users")
    op.drop_index(op.f("ix_users_contribution_level"), table_name="users")
    op.drop_index("idx_user_username", table_name="users")
    op.drop_index("idx_user_email", table_name="users")
    op.drop_index("idx_user_contribution_level", table_name="users")
    op.drop_table("users")
    op.drop_index(op.f("ix_tracker_url"), table_name="tracker")
    op.drop_index(op.f("ix_tracker_status"), table_name="tracker")
    op.drop_table("tracker")
    op.drop_index(op.f("ix_rating_provider_name"), table_name="rating_provider")
    op.drop_table("rating_provider")
    op.drop_index(op.f("ix_production_company_name"), table_name="production_company")
    op.drop_table("production_company")
    op.drop_index(op.f("ix_parental_certificate_name"), table_name="parental_certificate")
    op.drop_table("parental_certificate")
    op.drop_index(op.f("ix_metadata_provider_name"), table_name="metadata_provider")
    op.drop_table("metadata_provider")
    op.drop_index(op.f("ix_language_name"), table_name="language")
    op.drop_table("language")
    op.drop_index(op.f("ix_keyword_name"), table_name="keyword")
    op.drop_table("keyword")
    op.drop_index(op.f("ix_hdr_format_name"), table_name="hdr_format")
    op.drop_table("hdr_format")
    op.drop_index(op.f("ix_genre_name"), table_name="genre")
    op.drop_table("genre")
    op.drop_index(op.f("ix_daily_stats_stat_date"), table_name="daily_stats")
    op.drop_table("daily_stats")
    op.drop_table("contribution_settings")
    op.drop_index(op.f("ix_catalog_name"), table_name="catalog")
    op.drop_table("catalog")
    op.drop_index(op.f("ix_audio_format_name"), table_name="audio_format")
    op.drop_table("audio_format")
    op.drop_index(op.f("ix_audio_channel_name"), table_name="audio_channel")
    op.drop_table("audio_channel")
    # ### end Alembic commands ###
